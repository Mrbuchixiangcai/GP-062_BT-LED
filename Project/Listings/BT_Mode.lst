C51 COMPILER V9.00   BT_MODE                                                               12/04/2018 17:30:26 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE BT_MODE
OBJECT MODULE PLACED IN ..\Object\BT_Mode.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE ..\Hardware\BT\BT_Mode.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..
                    -\User;..\Hardware;..\Hardware\BT;..\Hardware\KEY;..\Hardware\LED) DEBUG OBJECTEXTEND PRINT(.\Listings\BT_Mode.lst) OBJEC
                    -T(..\Object\BT_Mode.obj)

line level    source

   1          /*************************************************************/
   2          /*头文件Header File*******************************************/
   3          /*************************************************************/
   4          #include "app_main.h"
   5          
   6          /*************************************************************/
   7          /*宏定义Macro Definition**************************************/
   8          /*************************************************************/
   9          
  10          /*************************************************************/
  11          /*类型定义Byte Definition*************************************/
  12          /*************************************************************/
  13          
  14          /*************************************************************/
  15          /*标志位定义Flags Definition**********************************/
  16          /*************************************************************/
  17          bit Flag_BT_work;
  18          bit Flag_BT_Connect;//蓝牙连接标志位
  19          uint8_t Flag_BT_Play;   //蓝牙播放,1是在播放，0是在暂停(停止)
  20          bit Flag_UART1_RX_Finish_A;
  21          bit Flag_UART1_RX_Finish_B;
  22          bit Flag_UART_ReceiveBuffer_A_B;
  23          bit Flag_BT_TF_Play;//蓝牙TF卡播放模式，1正在播放，0是在暂停(停止)
  24          uint8_t Flag_BT_Pairing;//蓝牙一开机，但是没有连接，处在配对状态，为1为配对，为2位连接成功
  25          
  26          /*************************************************************/
  27          /*变量定义Variable Definition*********************************/
  28          /*************************************************************/
  29          uint8_t  idata bt_cmd;
  30          uint8_t  idata cntMuteBT;
  31          uint8_t  idata bt_Volume;
  32          uint8_t  idata uart1_RX_Pointer;
  33          uint8_t  idata uart1_TX_Pointer;
  34          uint8_t  idata uart1_EnableSend;
  35          uint8_t  idata uart1_TX_Timeout;
  36          uint8_t  idata uart1_RX_Timeout;
  37          uint8_t  idata Uart_Len;//本来是UART1_LEN_BUFFER，但是这是临时
  38          
  39          /*************************************************************/
  40          /*数组定义Array Definition************************************/
  41          /*************************************************************/
  42          uint8_t  uart1_TransmitBuffer[UART1_LEN_BUFFER];
  43          uint8_t  idata uart1_ReceiveBuffer_A[UART1_LEN_BUFFER];
  44          uint8_t  idata uart1_ReceiveBuffer_B[UART1_LEN_BUFFER];
  45          
  46          /*************************************************************/
  47          /*函数声明Function Declaration********************************/
  48          /*************************************************************/
  49          
  50          /*************************************************************/
  51          /*函数定义Function Definition*********************************/
  52          /*************************************************************/
  53          /*******************************************************************************
C51 COMPILER V9.00   BT_MODE                                                               12/04/2018 17:30:26 PAGE 2   

  54           * 函数原型：
  55           * 输入参数：
  56           * 输出参数：
  57           * 函数功能：串口发送字符
  58           * 返回值说明：
  59           * 创建日期：
  60           * 创建人：
  61           * 修改日期
  62           * 修改人：
  63           * 第N次修改：
  64           * 修改原因：
  65           * 备注：
  66           *******************************************************************************/
  67          void Uart1Transmit_SendString(char *str)
  68          {
  69   1              uint8_t  i;
  70   1              while(uart1_EnableSend);
  71   1              for(i=0;i<UART1_LEN_BUFFER;i++)
  72   1              {
  73   2                      uart1_TransmitBuffer[i]=0;
  74   2              }
  75   1              //for(i=0;*str != '\0';i++)
  76   1              for(i=0;i<Uart_Len;i++)
  77   1              {
  78   2                      uart1_TransmitBuffer[i]=*str;
  79   2                      str++;
  80   2              }
  81   1              uart1_TX_Pointer=0;
  82   1              uart1_EnableSend=1;
  83   1              UARTDR=uart1_TransmitBuffer[uart1_TX_Pointer++];
  84   1      }
  85          
  86          /*******************************************************************************
  87          * 函数原型：
  88          * 输入参数：
  89          * 输出参数：
  90          * 函数功能：发送命令，通过传进来的数据判断选择哪个命令发送
  91          * 返回值说明：
  92          * 创建日期：
  93          * 创建人：
  94          * 修改日期
  95          * 修改人：
  96          * 第N次修改：
  97          * 修改原因：
  98          * 备注：
  99          *******************************************************************************/
 100          void BT_Send_CMD(uint8_t cmd)
 101          {
 102   1              //uint8_t  code bt_VOL_Send_Tab[]={0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};
 103   1              if(cmd<BT_PLAY)
 104   1              {
 105   2                      
 106   2              }
 107   1              else
 108   1              {
 109   2                      
 110   2              }
 111   1      }
 112          
 113          /*******************************************************************************
 114          * 函数原型：
 115          * 输入参数：
C51 COMPILER V9.00   BT_MODE                                                               12/04/2018 17:30:26 PAGE 3   

 116          * 输出参数：
 117          * 函数功能：
 118          * 返回值说明：
 119          * 创建日期：
 120          * 创建人：
 121          * 修改日期
 122          * 修改人：
 123          * 第N次修改：
 124          * 修改原因：
 125          * 备注：
 126          *******************************************************************************/
 127          void BlueMode_Receive(void)
 128          {
 129   1              uint8_t  i;
 130   1              char *BT_CMD;
 131   1              if((Flag_UART1_RX_Finish_A) || (Flag_UART1_RX_Finish_B))
 132   1              {
 133   2                      if(Flag_UART1_RX_Finish_A)
 134   2                      {
 135   3                              Flag_UART1_RX_Finish_A=0;
 136   3                              BT_CMD=uart1_ReceiveBuffer_A;
 137   3                      }
 138   2                      else 
 139   2                      {
 140   3                              Flag_UART1_RX_Finish_B=0;
 141   3                              BT_CMD=uart1_ReceiveBuffer_B;
 142   3                      }
 143   2                      if((BT_CMD[0] == 'B') && (BT_CMD[1] == 'T'))
 144   2                      {
 145   3                              
 146   3                              
 147   3                      }
 148   2                      if((BT_CMD[0] == 'S') && (BT_CMD[1] == 'D'))
 149   2                      {
 150   3                              
 151   3                      }
 152   2                      if((BT_CMD[0] == 'A') && (BT_CMD[1] == 'X'))
 153   2                      {
 154   3                              
 155   3                      }
 156   2                      if((BT_CMD[0] == 'C') && (BT_CMD[1] == 'O') && (BT_CMD[2] == 'M'))
 157   2                      {
 158   3                              
 159   3                      }
 160   2                      
 161   2                      for(i=0;i<UART1_LEN_BUFFER;i++)
 162   2                              BT_CMD[i]=0;
 163   2              }
 164   1      }
 165          
 166          
 167          
 168          
 169          /*******************************************************************************
 170          * 函数原型：
 171          * 输入参数：
 172          * 输出参数：
 173          * 函数功能：
 174          * 返回值说明：
 175          * 创建日期：
 176          * 创建人：
 177          * 修改日期
C51 COMPILER V9.00   BT_MODE                                                               12/04/2018 17:30:26 PAGE 4   

 178          * 修改人：
 179          * 第N次修改：
 180          * 修改原因：
 181          * 备注：
 182          *******************************************************************************/
 183          void BlueMode_Handle(void) //接收到的数据信息/状态进行处理
 184          {
 185   1              BlueMode_Receive();
 186   1                      if (sys_Volume != bt_Volume)//这里有问题，会一直复位蓝牙，现写显示，回来再改
 187   1                      {
 188   2                              bt_Volume = sys_Volume;
 189   2                              BT_Send_CMD(BT_VOL); //串口发送音量信息到蓝牙端
 190   2                      }
 191   1      
 192   1      }
 193          
 194          
 195          
 196          
 197          
 198          
 199          
 200          
 201          
 202          
 203          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    142    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       4
   IDATA SIZE       =     25    ----
   BIT SIZE         =      6    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
