C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LED_MODE
OBJECT MODULE PLACED IN ..\Object\LED_Mode.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE ..\Hardware\LED\LED_Mode.c OPTIMIZE(8,SPEED) BROWSE INCDIR(
                    -..\User;..\Hardware;..\Hardware\BT;..\Hardware\KEY;..\Hardware\LED;..\Hardware\SystemSleep) DEBUG OBJECTEXTEND PRINT(.\L
                    -istings\LED_Mode.lst) OBJECT(..\Object\LED_Mode.obj)

line level    source

   1          /*************************************************************/
   2          /*头文件Header File*******************************************/
   3          /*************************************************************/
   4          #include "app_main.h"
   5          
   6          /*************************************************************/
   7          /*宏定义Macro Definition**************************************/
   8          /*************************************************************/
   9          uint8_t displayBuff[5];
  10          #define DIG_NUM1 displayBuff[0]
  11          #define DIG_NUM2 displayBuff[1]
  12          #define DIG_NUM3 displayBuff[2]
  13          #define DIG_NUM4 displayBuff[3]
  14          #define DIG_NUM5 displayBuff[4]
  15          
  16          /*************************************************************/
  17          /*类型定义Byte Definition**************************************/
  18          /*************************************************************/
  19          LED_BRIGHTNESS_E_TypeDef LED_Brightness_TD;//TD:TypeDef
  20          /*************************************************************/
  21          /*标志位定义Flags Definition***********************************/
  22          /*************************************************************/
  23          BOOL    gbUser_AdjClk;
  24          
  25          bit     Flag_Beep1;
  26          bit             Flag_Dot;
  27          bit     Flag_APM;
  28          bit     Flag_BT_LED;
  29          bit             Flag_AL_LED;
  30          bit             Flag_Year_0_5s_Disp;//在设置年的时候，20和18交替0.5秒显示
  31          
  32          uint8_t Flag_DisplayStatus;//显示状态，显示某个状态时会被赋值
  33          
  34          
  35          /*************************************************************/
  36          /*变量定义Variable Definition**********************************/
  37          /*************************************************************/
  38          uint16_t cntDisplayStatus;
  39          uint8_t  idata LED_Reg1;
  40          uint8_t  idata LED_Reg2;
  41          uint8_t  idata LED_Reg3;
  42          uint8_t  idata LED_Reg4;
  43          uint8_t  idata LED_Reg5;
  44          uint8_t  idata LED_Reg6;
  45          uint8_t  idata Disp_cnt;
  46          
  47          /*************************************************************/
  48          /*数组定义Array Definition************************************/
  49          /*************************************************************/
  50          code uint8_t DisplayCode[]=
  51          {
  52                  DIG_0,            
  53                  DIG_1,           
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 2   

  54                  DIG_2,           
  55                  DIG_3,           
  56                  DIG_4,          
  57                  DIG_5,           
  58                  DIG_6,           
  59                  DIG_7,           
  60                  DIG_8,           
  61                  DIG_9,           
  62                  DIG_NONE,             
  63                  CH_a,            
  64                  CH_b,           
  65                  CH_c,            
  66                  CH_d,            
  67                  CH_h,            
  68                  CH_l,            
  69                  CH_n,            
  70                  CH_o,           
  71                  CH_r,           
  72                  CH_t,            
  73                  CH_u,             
  74                  CH_y,             
  75                  CH_A,            
  76                  CH_C,           
  77                  CH_E,            
  78                  CH_F,            
  79                  CH_G,            
  80                  CH_H,            
  81                  CH_I,             
  82                  CH_J,            
  83                  CH_L,           
  84                  CH_N,            
  85                  CH_O,            
  86                  CH_P,            
  87                  CH_S,            
  88                  CH_U,             
  89                  CH__
  90          };
  91          /*************************************************************/
  92          /*函数声明Function Declaration*********************************/
  93          /*************************************************************/
  94          
  95          /*************************************************************/
  96          /*函数定义Function Definition**********************************/
  97          /*************************************************************/
  98          /*******************************************************************************
  99          * 函数原型：
 100          * 输入参数：
 101          * 输出参数：
 102          * 函数功能：清除显示缓存
 103          * 返回值说明：
 104          * 创建日期：
 105          * 创建人：
 106          * 修改日期
 107          * 修改人：
 108          * 第N次修改：
 109          * 修改原因：
 110          * 备注：
 111          *******************************************************************************/
 112          void ClearDisplayBuff(void)
 113          {
 114   1              LED_Reg1=0;
 115   1              LED_Reg2=0;
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 3   

 116   1              LED_Reg3=0;
 117   1              LED_Reg4=0;
 118   1              LED_Reg5=0;
 119   1              LED_Reg6=0;
 120   1      }
 121          
 122          /*******************************************************************************
 123          * 函数原型：
 124          * 输入参数：
 125          * 输出参数：
 126          * 函数功能：把数值转化为显示格式
 127          * 返回值说明：
 128          * 创建日期：
 129          * 创建人：
 130          * 修改日期
 131          * 修改人：
 132          * 第N次修改：
 133          * 修改原因：
 134          * 备注：
 135          *******************************************************************************/
 136          void DisplayNum12(uint8_t dat)
 137          {
 138   1              if(dat / 10)
 139   1                      DigNum1((dat/10));
 140   1              DigNum2((dat%10));
 141   1      }
 142          
 143          /*******************************************************************************
 144          * 函数原型：
 145          * 输入参数：
 146          * 输出参数：
 147          * 函数功能：把数值转化为显示格式
 148          * 返回值说明：
 149          * 创建日期：
 150          * 创建人：
 151          * 修改日期
 152          * 修改人：
 153          * 第N次修改：
 154          * 修改原因：
 155          * 备注：
 156          *******************************************************************************/
 157          void DisplayNum34(uint8_t dat)
 158          {
 159   1              DigNum3((dat/10));
 160   1              DigNum4((dat%10));
 161   1      }
 162          
 163          /*******************************************************************************
 164          * 函数原型：
 165          * 输入参数：
 166          * 输出参数：
 167          * 函数功能：关闭显示
 168          * 返回值说明：
 169          * 创建日期：
 170          * 创建人：
 171          * 修改日期
 172          * 修改人：
 173          * 第N次修改：
 174          * 修改原因：
 175          * 备注：
 176          *******************************************************************************/
 177          void Display_Off(void)
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 4   

 178          {
 179   1              DisplayNum12(0);
 180   1              DisplayNum34(0);
 181   1              P2=0x00;
 182   1              P3=0xFF;
 183   1      }
 184          
 185          /*******************************************************************************
 186          * 函数原型：
 187          * 输入参数：
 188          * 输出参数：
 189          * 函数功能：时间分割
 190          * 返回值说明：
 191          * 创建日期：
 192          * 创建人：
 193          * 修改日期
 194          * 修改人：
 195          * 第N次修改：
 196          * 修改原因：
 197          * 备注：
 198          *******************************************************************************/
 199          void Display_HH_MM(uint8_t hhmmType)
 200          {
 201   1              uint8_t tmpHour,tmpMinute;
 202   1              switch(hhmmType)
 203   1              {
 204   2                      case eDS_RTC:   //显示RTC
 205   2                              tmpHour = gRTC_Hour;
 206   2                              tmpMinute = gRTC_Minute;
 207   2                              break;
 208   2                      case ADJ_CLK:   //设置RTC
 209   2                              tmpHour = gRTC_Hour;
 210   2                              tmpMinute = gRTC_Minute;
 211   2                              break;
 212   2                      case eDS_AL1:   //显示闹钟时间
 213   2                              tmpHour = AL1_TD.hour;
 214   2                              tmpMinute = AL1_TD.minute;
 215   2                              break;
 216   2                      case ADJ_ALARM1://设置时显示闹钟时间
 217   2                              tmpHour = AL1_TD.hour;
 218   2                              tmpMinute = AL1_TD.minute;
 219   2                              break;
 220   2              }
 221   1              if(Flag_12HourDisplay)
 222   1              {
 223   2                      if(tmpHour<12)
 224   2                      { 
 225   3                              Flag_APM=0;
 226   3                      }
 227   2                      else
 228   2                      { 
 229   3                              Flag_APM=1;
 230   3                              tmpHour-=12;
 231   3                      }
 232   2                      if(tmpHour==0)
 233   2                              tmpHour=12;           
 234   2              }
 235   1              DisplayNum12(tmpHour);
 236   1              DisplayNum34(tmpMinute);
 237   1      }
 238          
 239          /*******************************************************************************
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 5   

 240          * 函数原型：
 241          * 输入参数：
 242          * 输出参数：
 243          * 函数功能：时间分割-小时
 244          * 返回值说明：
 245          * 创建日期：
 246          * 创建人：
 247          * 修改日期
 248          * 修改人：
 249          * 第N次修改：
 250          * 修改原因：
 251          * 备注：
 252          *******************************************************************************/
 253          void Display_HH(uint8_t hhmmType)
 254          {
 255   1              uint8_t tmpHour;
 256   1              switch(hhmmType)
 257   1              {
 258   2                      case eDS_RTC:   //显示RTC
 259   2                              tmpHour = gRTC_Hour;
 260   2                              break;
 261   2                      case ADJ_CLK:   //设置RTC
 262   2                              tmpHour = gRTC_Hour;
 263   2                              break;
 264   2                      case eDS_AL1:   //显示闹钟时间
 265   2                              tmpHour = gRTC_Hour;
 266   2                              break;
 267   2                      case ADJ_ALARM1://设置时显示闹钟时间
 268   2                              tmpHour = AL1_TD.hour;
 269   2                              break;
 270   2              }
 271   1              if(Flag_12HourDisplay)
 272   1              {
 273   2                      if(tmpHour<12)
 274   2                      { 
 275   3                              Flag_APM=0;
 276   3                      }
 277   2                      else
 278   2                      { 
 279   3                              Flag_APM=1;
 280   3                              tmpHour-=12;
 281   3                      }
 282   2                      if(tmpHour==0)
 283   2                              tmpHour=12;           
 284   2              }
 285   1              DisplayNum12(tmpHour);
 286   1      }
 287          
 288          /*******************************************************************************
 289          * 函数原型：
 290          * 输入参数：
 291          * 输出参数：
 292          * 函数功能：时间分割-分钟
 293          * 返回值说明：
 294          * 创建日期：
 295          * 创建人：
 296          * 修改日期
 297          * 修改人：
 298          * 第N次修改：
 299          * 修改原因：
 300          * 备注：
 301          *******************************************************************************/
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 6   

 302          void Display_MM(uint8_t hhmmType)
 303          {
 304   1              uint8_t tmpMinute;
 305   1              switch(hhmmType)
 306   1              {
 307   2                      case eDS_RTC:   //显示RTC
 308   2                              tmpMinute = gRTC_Minute;
 309   2                              break;
 310   2                      case ADJ_CLK:   //设置RTC
 311   2                              tmpMinute = gRTC_Minute;
 312   2                              break;
 313   2                      case eDS_AL1:   //显示闹钟时间
 314   2                              tmpMinute = gRTC_Minute;
 315   2                              break;
 316   2                      case ADJ_ALARM1://设置时显示闹钟时间
 317   2                              tmpMinute = AL1_TD.minute;
 318   2                              break;
 319   2                      case ADJ_SNOOZE_TIME: //设置贪睡时间
 320   2                              tmpMinute=AL1_TD.snoozeTime;
 321   2                              break;
 322   2              }
 323   1              DisplayNum34(tmpMinute);
 324   1      }
 325          
 326          /*******************************************************************************
 327          * 函数原型：
 328          * 输入参数：
 329          * 输出参数：
 330          * 函数功能：不闪
 331          * 返回值说明：
 332          * 创建日期：
 333          * 创建人：
 334          * 修改日期
 335          * 修改人：
 336          * 第N次修改：
 337          * 修改原因：
 338          * 备注：
 339          *******************************************************************************/
 340          BOOL NoFlash(void)
 341          {
 342   1              if(cntNoFlash != 0)
 343   1                      return 1;
 344   1              return 0;
 345   1      }
 346          
 347          /*******************************************************************************
 348          * 函数原型：
 349          * 输入参数：
 350          * 输出参数：
 351          * 函数功能：RTC显示
 352          * 返回值说明：
 353          * 创建日期：
 354          * 创建人：
 355          * 修改日期
 356          * 修改人：
 357          * 第N次修改：
 358          * 修改原因：
 359          * 备注：
 360          *******************************************************************************/
 361          void Display_RTC(void)
 362          {
 363   1              if((!gbUser_AdjClk)||(gRTC_HalfSecond))
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 7   

 364   1              {
 365   2                      Display_HH_MM(eDS_RTC);
 366   2              }
 367   1      }
 368          
 369          /*******************************************************************************
 370          * 函数原型：
 371          * 输入参数：
 372          * 输出参数：
 373          * 函数功能：设置RTC时LED的显示
 374          * 返回值说明：
 375          * 创建日期：
 376          * 创建人：
 377          * 修改日期
 378          * 修改人：
 379          * 第N次修改：
 380          * 修改原因：
 381          * 备注：
 382          *******************************************************************************/
 383          void Display_SetRTC(void)
 384          {
 385   1              if((Flag_0_5s)||(NoFlash()))
 386   1              {
 387   2                      Display_HH_MM(eDS_RTC);
 388   2              }
 389   1      }
 390          
 391          
 392          /*******************************************************************************
 393          * 函数原型：
 394          * 输入参数：
 395          * 输出参数：
 396          * 函数功能：设置RTC时LED的年份显示
 397          * 返回值说明：
 398          * 创建日期：
 399          * 创建人：
 400          * 修改日期
 401          * 修改人：
 402          * 第N次修改：
 403          * 修改原因：
 404          * 备注：
 405          *******************************************************************************/
 406          void Display_SetRTCYear(void)
 407          {
 408   1              if((Flag_0_5s)||(NoFlash()))
 409   1              {
 410   2                      //0.5进来一次，20和18交替显示
 411   2      //              if(Flag_Year_0_5s_Disp==0)
 412   2      //              {
 413   2      //                      //DisplayNum12(20);
 414   2      //                      SET_2G();//显示一个"-"
 415   2      //                      DisplayNum34(20);
 416   2      //              }
 417   2      //              else
 418   2      //              {
 419   2      //                      SET_2G();//显示一个"-"
 420   2      //                      DisplayNum34(gRTC_Year);
 421   2      //              }
 422   2                      SET_2G();//显示一个"-"
 423   2                      DisplayNum34(gRTC_Year);
 424   2              }
 425   1      }
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 8   

 426          
 427          /*******************************************************************************
 428          * 函数原型：
 429          * 输入参数：
 430          * 输出参数：
 431          * 函数功能：设置RTC时LED的月的LED显示
 432          * 返回值说明：
 433          * 创建日期：
 434          * 创建人：
 435          * 修改日期
 436          * 修改人：
 437          * 第N次修改：
 438          * 修改原因：
 439          * 备注：
 440          *******************************************************************************/
 441          void Display_SetRTCMonth(void)
 442          {
 443   1              if((Flag_0_5s)||(NoFlash()))
 444   1              {
 445   2                      DisplayNum12(gRTC_Month);
 446   2              }
 447   1              DisplayNum34(gRTC_Day);
 448   1      }
 449          
 450          /*******************************************************************************
 451          * 函数原型：
 452          * 输入参数：
 453          * 输出参数：
 454          * 函数功能：设置RTC时LED的日的LED显示
 455          * 返回值说明：
 456          * 创建日期：
 457          * 创建人：
 458          * 修改日期
 459          * 修改人：
 460          * 第N次修改：
 461          * 修改原因：
 462          * 备注：
 463          *******************************************************************************/
 464          //这里暂时不用
 465          void Display_SetRTCDay(void)
 466          {
 467   1              if((Flag_0_5s)||(NoFlash()))
 468   1              {
 469   2                      DisplayNum34(gRTC_Day);
 470   2              }
 471   1              DisplayNum12(gRTC_Month);
 472   1      }
 473          
 474          
 475          /*******************************************************************************
 476          * 函数原型：
 477          * 输入参数：
 478          * 输出参数：
 479          * 函数功能：设置RTC时LED的小时的LED显示
 480          * 返回值说明：
 481          * 创建日期：
 482          * 创建人：
 483          * 修改日期
 484          * 修改人：
 485          * 第N次修改：
 486          * 修改原因：
 487          * 备注：
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 9   

 488          *******************************************************************************/
 489          void Display_SetRTCHour(void)
 490          {
 491   1              if((Flag_0_5s)||(NoFlash()))
 492   1              {
 493   2                      //DisplayNum12(gRTC_Hour);
 494   2                      Display_HH_MM(ADJ_CLK);
 495   2              }
 496   1              //DisplayNum34(gRTC_Minute);
 497   1              Display_MM(ADJ_CLK);
 498   1      }
 499          
 500          /*******************************************************************************
 501          * 函数原型：
 502          * 输入参数：
 503          * 输出参数：
 504          * 函数功能：设置RTC时LED的分钟的LED显示
 505          * 返回值说明：
 506          * 创建日期：
 507          * 创建人：
 508          * 修改日期
 509          * 修改人：
 510          * 第N次修改：
 511          * 修改原因：
 512          * 备注：
 513          *******************************************************************************/
 514          void Display_SetRTCMinute(void)
 515          {
 516   1              if((Flag_0_5s)||(NoFlash()))
 517   1              {
 518   2                      //DisplayNum34(gRTC_Minute);
 519   2                      Display_HH_MM(ADJ_CLK);
 520   2              }
 521   1              Display_HH(ADJ_CLK);//显示小时
 522   1      }
 523          
 524          /*******************************************************************************
 525          * 函数原型：
 526          * 输入参数：
 527          * 输出参数：
 528          * 函数功能：夏令时区选择
 529          * 返回值说明：
 530          * 创建日期：
 531          * 创建人：
 532          * 修改日期
 533          * 修改人：
 534          * 第N次修改：
 535          * 修改原因：
 536          * 备注：
 537          *******************************************************************************/
 538          void Display_SetZone(void)
 539          {
 540   1              if((Flag_0_5s)||(NoFlash()))
 541   1              {
 542   2                      DisplayNum34(gRTC_Zone);
 543   2              }
 544   1      }
 545          
 546          /*******************************************************************************
 547          * 函数原型：
 548          * 输入参数：
 549          * 输出参数：
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 10  

 550          * 函数功能：贪睡时间
 551          * 返回值说明：
 552          * 创建日期：
 553          * 创建人：
 554          * 修改日期
 555          * 修改人：
 556          * 第N次修改：
 557          * 修改原因：
 558          * 备注：
 559          *******************************************************************************/
 560          void Display_SnoozeTime(void)
 561          {
 562   1              if((Flag_0_5s)||(NoFlash()))
 563   1              {
 564   2                      Display_MM(ADJ_SNOOZE_TIME);
 565   2              }
 566   1      }
 567          
 568          /*******************************************************************************
 569          * 函数原型：
 570          * 输入参数：
 571          * 输出参数：
 572          * 函数功能：闹钟非设置时的显示
 573          * 返回值说明：
 574          * 创建日期：
 575          * 创建人：
 576          * 修改日期
 577          * 修改人：
 578          * 第N次修改：
 579          * 修改原因：
 580          * 备注：
 581          *******************************************************************************/
 582          void Display_Alarm1(void)
 583          {
 584   1              
 585   1      }
 586          
 587          /*******************************************************************************
 588          * 函数原型：
 589          * 输入参数：
 590          * 输出参数：
 591          * 函数功能：闹钟设置时的显示
 592          * 返回值说明：
 593          * 创建日期：
 594          * 创建人：
 595          * 修改日期
 596          * 修改人：
 597          * 第N次修改：
 598          * 修改原因：
 599          * 备注：
 600          *******************************************************************************/
 601          void Display_SetAlarm1(void)
 602          {
 603   1              
 604   1      }
 605          
 606          /*******************************************************************************
 607          * 函数原型：
 608          * 输入参数：
 609          * 输出参数：
 610          * 函数功能：设置闹钟小时的显示
 611          * 返回值说明：
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 11  

 612          * 创建日期：
 613          * 创建人：
 614          * 修改日期
 615          * 修改人：
 616          * 第N次修改：
 617          * 修改原因：
 618          * 备注：
 619          *******************************************************************************/
 620          void Display_SetAlarm1_Hour(void)
 621          {
 622   1              if((Flag_0_5s)||(NoFlash()))
 623   1              {
 624   2                      Display_HH_MM(ADJ_ALARM1);
 625   2              }
 626   1              Display_MM(ADJ_ALARM1);//显示分钟
 627   1      }
 628          
 629          /*******************************************************************************
 630          * 函数原型：
 631          * 输入参数：
 632          * 输出参数：
 633          * 函数功能：设置闹钟分钟的显示
 634          * 返回值说明：
 635          * 创建日期：
 636          * 创建人：
 637          * 修改日期
 638          * 修改人：
 639          * 第N次修改：
 640          * 修改原因：
 641          * 备注：
 642          *******************************************************************************/
 643          void Display_SetAlarm1_Min(void)
 644          {
 645   1              if((Flag_0_5s)||(NoFlash()))
 646   1              {
 647   2                      Display_HH_MM(ADJ_ALARM1);
 648   2              }
 649   1              Display_HH(ADJ_ALARM1);//显示分钟
 650   1      }
 651          
 652          /*******************************************************************************
 653          * 函数原型：
 654          * 输入参数：
 655          * 输出参数：
 656          * 函数功能：设置闹钟工作模式的显示
 657          * 返回值说明：
 658          * 创建日期：
 659          * 创建人：
 660          * 修改日期
 661          * 修改人：
 662          * 第N次修改：
 663          * 修改原因：
 664          * 备注：
 665          *******************************************************************************/
 666          void Display_SetAlarm1_Work(void)
 667          {
 668   1              
 669   1      }
 670          
 671          /*******************************************************************************
 672          * 函数原型：
 673          * 输入参数：
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 12  

 674          * 输出参数：
 675          * 函数功能：在某个状态时显示10秒，比如设置RTC或者闹钟时闪烁或者显示长度
 676          * 返回值说明：
 677          * 创建日期：
 678          * 创建人：
 679          * 修改日期
 680          * 修改人：
 681          * 第N次修改：
 682          * 修改原因：
 683          * 备注：
 684          *******************************************************************************/
 685          void SetDisplayState10s(uint8_t status)
 686          {
 687   1              Flag_DisplayStatus=status;//把要显示的状态赋值给全局变量
 688   1              cntDisplayStatus=cDISP_DELAY_10SEC;
 689   1      }
 690          
 691          /*******************************************************************************
 692          * 函数原型：
 693          * 输入参数：
 694          * 输出参数：
 695          * 函数功能：在某个状态时显示2秒，比如设置RTC或者闹钟时闪烁或者显示长度
 696          * 返回值说明：
 697          * 创建日期：
 698          * 创建人：
 699          * 修改日期
 700          * 修改人：
 701          * 第N次修改：
 702          * 修改原因：
 703          * 备注：
 704          *******************************************************************************/
 705          void SetDisplayState2s(uint8_t status)
 706          {
 707   1              Flag_DisplayStatus=status;//把要显示的状态赋值给全局变量
 708   1              cntDisplayStatus=cDISP_DELAY_5SEC;
 709   1      }
 710          
 711          /*******************************************************************************
 712          * 函数原型：
 713          * 输入参数：
 714          * 输出参数：
 715          * 函数功能：更新要显示的内容
 716          * 返回值说明：
 717          * 创建日期：
 718          * 创建人：
 719          * 修改日期
 720          * 修改人：
 721          * 第N次修改：
 722          * 修改原因：
 723          * 备注：
 724          *******************************************************************************/
 725          void UpdateDisplay(void)
 726          {
 727   1              switch (Flag_DisplayStatus)
 728   1              {
 729   2                      case ADJ_CLK:
 730   2                              Display_SetRTC();                //设置RTC时的显示
 731   2                              break;
 732   2                      case ADJ_YEAR:                           //设置RTC的年
 733   2                              Display_SetRTCYear();
 734   2                              break;
 735   2                      case ADJ_MONTH:                          //设置RTC的月期
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 13  

 736   2                              Display_SetRTCMonth();
 737   2                              break;
 738   2                      case ADJ_DAY:                            //设置RTC的日期
 739   2                              Display_SetRTCDay();
 740   2                              break;
 741   2                      case ADJ_HOUR:                           //设置RTC小时的显示
 742   2                              Display_SetRTCHour();
 743   2                              break;
 744   2                      case ADJ_MINUTE:                         //设置RTC分钟的显示
 745   2                              Display_SetRTCMinute();
 746   2                              break;
 747   2                      case ADJ_DAYLIGHT_SAVING_ZONES://设置夏令时区
 748   2                              Display_SetZone();
 749   2                              break; 
 750   2                      case ADJ_SNOOZE_TIME:            //设置贪睡时间
 751   2                              Display_SnoozeTime();
 752   2                              break; 
 753   2                      case DISP_AL1:                           //闹钟非设置时的显示
 754   2                              Display_Alarm1();   
 755   2                              break;
 756   2                      case ADJ_ALARM1:                         //设置闹钟的显示
 757   2                              Display_SetAlarm1();     
 758   2                              break;
 759   2                      case ADJ_ALARM1_HOUR:            //设置闹钟小时的显示
 760   2                              Display_SetAlarm1_Hour();
 761   2                              break; 
 762   2                      case ADJ_ALARM1_MINUTE:          //设置闹钟分钟的显示
 763   2                              Display_SetAlarm1_Min(); 
 764   2                              break; 
 765   2                      case POWER_OFF_DISP:             //关闭显示
 766   2                              Display_Off();
 767   2                              break; 
 768   2                      default:
 769   2                              Display_RTC();                   //RTC走时状态显示
 770   2                              break;
 771   2              }
 772   1              if (cntNoFlash != 0)
 773   1                      cntNoFlash--;
 774   1      }
 775          
 776          /*******************************************************************************
 777          * 函数原型：
 778          * 输入参数：
 779          * 输出参数：
 780          * 函数功能：需要亮的一些标记，比如点，或者闹钟标志
 781          * 返回值说明：
 782          * 创建日期：
 783          * 创建人：
 784          * 修改日期
 785          * 修改人：
 786          * 第N次修改：
 787          * 修改原因：
 788          * 备注：
 789          *******************************************************************************/
 790          void Display_Flag(void)
 791          {
 792   1              if(Flag_PowerOn)//开机进入
 793   1              {
 794   2                      if(Flag_APM==0)
 795   2                      {
 796   3                              CLR_APM();//这里是上午不亮，下午亮
 797   3                      }
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 14  

 798   2                      else
 799   2                      {
 800   3                              SET_APM();
 801   3                      }
 802   2                      
 803   2                      /*******************************************************************************
 804   2                      *功能：闹钟标志LED亮灭是在闹钟开启和设置贪睡时间时
 805   2                      *
 806   2                      ********************************************************************************/
 807   2                      if((AL1_TD.OnOff_TD==ALARM_ON) || (Flag_DisplayStatus==ADJ_SNOOZE_TIME))
 808   2                      {
 809   3                              SET_ALA();//如果开闹钟就亮闹钟标志
 810   3                      }
 811   2                      else if(AL1_TD.OnOff_TD==ALARM_OFF)
 812   2                      {
 813   3                              CLR_ALA();
 814   3                      }
 815   2                      
 816   2                      /*******************************************************************************
 817   2                      *功能：秒点亮亮灭是在Flag_Dot为0和不在设置年月日的状态时就灭
 818   2                      *
 819   2                      ********************************************************************************/
 820   2                      if((Flag_Dot==0) || (Flag_DisplayStatus==ADJ_YEAR) || (Flag_DisplayStatus==ADJ_MONTH) || (Flag_DisplaySt
             -atus==ADJ_DAY))
 821   2                      {
 822   3                              CLR_DOT1();
 823   3                              CLR_DOT2();
 824   3                      }
 825   2                      else
 826   2                      {
 827   3                              SET_DOT1();//在main中的INT_WT()设立标志，
 828   3                              SET_DOT2();
 829   3                      }
 830   2              }
 831   1      }
 832          
 833          /*******************************************************************************
 834          * 函数原型：
 835          * 输入参数：
 836          * 输出参数：
 837          * 函数功能：更新要显示的内容
 838          * 返回值说明：
 839          * 创建日期：
 840          * 创建人：
 841          * 修改日期
 842          * 修改人：
 843          * 第N次修改：
 844          * 修改原因：
 845          * 备注：
 846          *******************************************************************************/
 847          void Display(void)
 848          {
 849   1              //uint8_t i;
 850   1              //if(cntDisplayStatus)
 851   1              //{
 852   1                      ClearDisplayBuff();
 853   1                      UpdateDisplay();
 854   1                      Display_Flag();
 855   1                      Display_LED();
 856   1                      cli();
 857   1                      LED_Tmp1 = LED_Reg1;
 858   1                      LED_Tmp2 = LED_Reg2;
C51 COMPILER V9.00   LED_MODE                                                              12/10/2018 10:35:37 PAGE 15  

 859   1                      LED_Tmp3 = LED_Reg3;
 860   1                      LED_Tmp4 = LED_Reg4;
 861   1                      sei();
 862   1              //}
 863   1      }
 864          
 865          
 866          
 867          
 868          
 869          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    734    ----
   CONSTANT SIZE    =     38    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       6
   IDATA SIZE       =      7    ----
   BIT SIZE         =      7    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
