C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LED_MODE
OBJECT MODULE PLACED IN ..\Object\LED_Mode.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE ..\Hardware\LED\LED_Mode.c OPTIMIZE(8,SPEED) BROWSE INCDIR(
                    -..\User;..\Hardware;..\Hardware\BT;..\Hardware\KEY;..\Hardware\LED;..\Hardware\SystemSleep) DEBUG OBJECTEXTEND PRINT(.\L
                    -istings\LED_Mode.lst) OBJECT(..\Object\LED_Mode.obj)

line level    source

   1          /*************************************************************/
   2          /*头文件Header File*******************************************/
   3          /*************************************************************/
   4          #include "app_main.h"
   5          
   6          /*************************************************************/
   7          /*宏定义Macro Definition**************************************/
   8          /*************************************************************/
   9          uint8_t displayBuff[5];
  10          #define DIG_NUM1 displayBuff[0]
  11          #define DIG_NUM2 displayBuff[1]
  12          #define DIG_NUM3 displayBuff[2]
  13          #define DIG_NUM4 displayBuff[3]
  14          #define DIG_NUM5 displayBuff[4]
  15          
  16          /*************************************************************/
  17          /*类型定义Byte Definition**************************************/
  18          /*************************************************************/
  19          LED_BRIGHTNESS_E_TypeDef LED_Brightness_TD;//TD:TypeDef
  20          /*************************************************************/
  21          /*标志位定义Flags Definition***********************************/
  22          /*************************************************************/
  23          BOOL    gbUser_AdjClk;
  24          
  25          bit     Flag_Beep1;
  26          bit             Flag_Dot;
  27          bit     Flag_APM;
  28          bit     Flag_BT_LED;
  29          bit             Flag_AL_LED;
  30          bit             Flag_Year_0_5s_Disp;//在设置年的时候，20和18交替0.5秒显示
  31          
  32          uint8_t Flag_DisplayStatus;//显示状态，显示某个状态时会被赋值
  33          
  34          
  35          /*************************************************************/
  36          /*变量定义Variable Definition**********************************/
  37          /*************************************************************/
  38          uint16_t cntDisplayStatus;
  39          uint8_t  idata LED_Reg1;
  40          uint8_t  idata LED_Reg2;
  41          uint8_t  idata LED_Reg3;
  42          uint8_t  idata LED_Reg4;
  43          uint8_t  idata LED_Reg5;
  44          uint8_t  idata LED_Reg6;
  45          uint8_t  idata Disp_cnt;
  46          
  47          /*************************************************************/
  48          /*数组定义Array Definition************************************/
  49          /*************************************************************/
  50          code uint8_t DisplayCode[]=
  51          {
  52                  DIG_0,            
  53                  DIG_1,           
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 2   

  54                  DIG_2,           
  55                  DIG_3,           
  56                  DIG_4,          
  57                  DIG_5,           
  58                  DIG_6,           
  59                  DIG_7,           
  60                  DIG_8,           
  61                  DIG_9,           
  62                  DIG_NONE,             
  63                  CH_a,            
  64                  CH_b,           
  65                  CH_c,            
  66                  CH_d,            
  67                  CH_h,            
  68                  CH_l,            
  69                  CH_n,            
  70                  CH_o,           
  71                  CH_r,           
  72                  CH_t,            
  73                  CH_u,             
  74                  CH_y,             
  75                  CH_A,            
  76                  CH_C,           
  77                  CH_E,            
  78                  CH_F,            
  79                  CH_G,            
  80                  CH_H,            
  81                  CH_I,             
  82                  CH_J,            
  83                  CH_L,           
  84                  CH_N,            
  85                  CH_O,            
  86                  CH_P,            
  87                  CH_S,            
  88                  CH_U,             
  89                  CH__
  90          };
  91          /*************************************************************/
  92          /*函数声明Function Declaration*********************************/
  93          /*************************************************************/
  94          
  95          /*************************************************************/
  96          /*函数定义Function Definition**********************************/
  97          /*************************************************************/
  98          /*******************************************************************************
  99          * 函数原型：
 100          * 输入参数：
 101          * 输出参数：
 102          * 函数功能：清除显示缓存
 103          * 返回值说明：
 104          * 创建日期：
 105          * 创建人：
 106          * 修改日期
 107          * 修改人：
 108          * 第N次修改：
 109          * 修改原因：
 110          * 备注：
 111          *******************************************************************************/
 112          void ClearDisplayBuff(void)
 113          {
 114   1              LED_Reg1=0;
 115   1              LED_Reg2=0;
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 3   

 116   1              LED_Reg3=0;
 117   1              LED_Reg4=0;
 118   1              LED_Reg5=0;
 119   1              LED_Reg6=0;
 120   1      }
 121          
 122          /*******************************************************************************
 123          * 函数原型：
 124          * 输入参数：
 125          * 输出参数：
 126          * 函数功能：把数值转化为显示格式
 127          * 返回值说明：
 128          * 创建日期：
 129          * 创建人：
 130          * 修改日期
 131          * 修改人：
 132          * 第N次修改：
 133          * 修改原因：
 134          * 备注：
 135          *******************************************************************************/
 136          void DisplayNum12(uint8_t dat)
 137          {
 138   1              if(dat / 10)
 139   1                      DigNum1((dat/10));
 140   1              DigNum2((dat%10));
 141   1      }
 142          
 143          /*******************************************************************************
 144          * 函数原型：
 145          * 输入参数：
 146          * 输出参数：
 147          * 函数功能：把数值转化为显示格式
 148          * 返回值说明：
 149          * 创建日期：
 150          * 创建人：
 151          * 修改日期
 152          * 修改人：
 153          * 第N次修改：
 154          * 修改原因：
 155          * 备注：
 156          *******************************************************************************/
 157          void DisplayNum34(uint8_t dat)
 158          {
 159   1              DigNum3((dat/10));
 160   1              DigNum4((dat%10));
 161   1      }
 162          
 163          /*******************************************************************************
 164          * 函数原型：
 165          * 输入参数：
 166          * 输出参数：
 167          * 函数功能：关闭显示
 168          * 返回值说明：
 169          * 创建日期：
 170          * 创建人：
 171          * 修改日期
 172          * 修改人：
 173          * 第N次修改：
 174          * 修改原因：
 175          * 备注：
 176          *******************************************************************************/
 177          void Display_Off(void)
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 4   

 178          {
 179   1              DisplayNum12(0);
 180   1              DisplayNum34(0);
 181   1              P2=0x00;
 182   1              P3=0xFF;
 183   1      }
 184          
 185          /*******************************************************************************
 186          * 函数原型：
 187          * 输入参数：
 188          * 输出参数：
 189          * 函数功能：时间分割
 190          * 返回值说明：
 191          * 创建日期：
 192          * 创建人：
 193          * 修改日期
 194          * 修改人：
 195          * 第N次修改：
 196          * 修改原因：
 197          * 备注：
 198          *******************************************************************************/
 199          void Display_HH_MM(uint8_t hhmmType)
 200          {
 201   1              uint8_t tmpHour,tmpMinute;
 202   1              switch(hhmmType)
 203   1              {
 204   2                      case eDS_RTC:   //显示RTC
 205   2                              tmpHour = gRTC_Hour;
 206   2                              tmpMinute = gRTC_Minute;
 207   2                              break;
 208   2                      case ADJ_CLK:   //设置RTC
 209   2                              tmpHour = gRTC_Hour;
 210   2                              tmpMinute = gRTC_Minute;
 211   2                              break;
 212   2                      case eDS_AL1:   //显示闹钟时间
 213   2                              tmpHour = AL1_TD.hour;
 214   2                              tmpMinute = AL1_TD.minute;
 215   2                              break;
 216   2                      case ADJ_ALARM1://设置时显示闹钟时间
 217   2                              tmpHour = AL1_TD.hour;
 218   2                              tmpMinute = AL1_TD.minute;
 219   2                              break;
 220   2              }
 221   1              if(Flag_12HourDisplay)
 222   1              {
 223   2                      if(tmpHour<12)
 224   2                      { 
 225   3                              Flag_APM=0;
 226   3                      }
 227   2                      else
 228   2                      { 
 229   3                              Flag_APM=1;
 230   3                              tmpHour-=12;
 231   3                      }
 232   2                      if(tmpHour==0)
 233   2                              tmpHour=12;           
 234   2              }
 235   1              DisplayNum12(tmpHour);
 236   1              DisplayNum34(tmpMinute);
 237   1      }
 238          
 239          /*******************************************************************************
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 5   

 240          * 函数原型：
 241          * 输入参数：
 242          * 输出参数：
 243          * 函数功能：时间分割-小时
 244          * 返回值说明：
 245          * 创建日期：
 246          * 创建人：
 247          * 修改日期
 248          * 修改人：
 249          * 第N次修改：
 250          * 修改原因：
 251          * 备注：
 252          *******************************************************************************/
 253          void Display_HH(uint8_t hhmmType)
 254          {
 255   1              uint8_t tmpHour;
 256   1              switch(hhmmType)
 257   1              {
 258   2                      case eDS_RTC:   //显示RTC
 259   2                              tmpHour = gRTC_Hour;
 260   2                              break;
 261   2                      case ADJ_CLK:   //设置RTC
 262   2                              tmpHour = gRTC_Hour;
 263   2                              break;
 264   2                      case eDS_AL1:   //显示闹钟时间
 265   2                              tmpHour = gRTC_Hour;
 266   2                              break;
 267   2                      case ADJ_ALARM1://设置时显示闹钟时间
 268   2                              tmpHour = AL1_TD.hour;
 269   2                              break;
 270   2              }
 271   1              if(Flag_12HourDisplay)
 272   1              {
 273   2                      if(tmpHour<12)
 274   2                      { 
 275   3                              Flag_APM=0;
 276   3                      }
 277   2                      else
 278   2                      { 
 279   3                              Flag_APM=1;
 280   3                              tmpHour-=12;
 281   3                      }
 282   2                      if(tmpHour==0)
 283   2                              tmpHour=12;           
 284   2              }
 285   1              DisplayNum12(tmpHour);
 286   1      }
 287          
 288          /*******************************************************************************
 289          * 函数原型：
 290          * 输入参数：
 291          * 输出参数：
 292          * 函数功能：时间分割-分钟
 293          * 返回值说明：
 294          * 创建日期：
 295          * 创建人：
 296          * 修改日期
 297          * 修改人：
 298          * 第N次修改：
 299          * 修改原因：
 300          * 备注：
 301          *******************************************************************************/
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 6   

 302          void Display_MM(uint8_t hhmmType)
 303          {
 304   1              uint8_t tmpMinute;
 305   1              switch(hhmmType)
 306   1              {
 307   2                      case eDS_RTC:   //显示RTC
 308   2                              tmpMinute = gRTC_Minute;
 309   2                              break;
 310   2                      case ADJ_CLK:   //设置RTC
 311   2                              tmpMinute = gRTC_Minute;
 312   2                              break;
 313   2                      case eDS_AL1:   //显示闹钟时间
 314   2                              tmpMinute = gRTC_Minute;
 315   2                              break;
 316   2                      case ADJ_ALARM1://设置时显示闹钟时间
 317   2                              tmpMinute = AL1_TD.minute;
 318   2                              break;
 319   2                      case ADJ_SNOOZE_TIME: //设置贪睡时间
 320   2                              tmpMinute=AL1_TD.snoozeTime;
 321   2                              break;
 322   2              }
 323   1              DisplayNum34(tmpMinute);
 324   1      }
 325          
 326          /*******************************************************************************
 327          * 函数原型：
 328          * 输入参数：
 329          * 输出参数：
 330          * 函数功能：不闪
 331          * 返回值说明：
 332          * 创建日期：
 333          * 创建人：
 334          * 修改日期
 335          * 修改人：
 336          * 第N次修改：
 337          * 修改原因：
 338          * 备注：
 339          *******************************************************************************/
 340          BOOL NoFlash(void)
 341          {
 342   1              if(cntNoFlash != 0)
 343   1                      return 1;
 344   1              return 0;
 345   1      }
 346          
 347          /*******************************************************************************
 348          * 函数原型：
 349          * 输入参数：
 350          * 输出参数：
 351          * 函数功能：RTC显示
 352          * 返回值说明：
 353          * 创建日期：
 354          * 创建人：
 355          * 修改日期
 356          * 修改人：
 357          * 第N次修改：
 358          * 修改原因：
 359          * 备注：
 360          *******************************************************************************/
 361          void Display_RTC(void)
 362          {
 363   1              if((!gbUser_AdjClk)||(gRTC_HalfSecond))
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 7   

 364   1              {
 365   2                      Display_HH_MM(eDS_RTC);
 366   2              }
 367   1      }
 368          
 369          /*******************************************************************************
 370          * 函数原型：
 371          * 输入参数：
 372          * 输出参数：
 373          * 函数功能：设置RTC时LED的显示
 374          * 返回值说明：
 375          * 创建日期：
 376          * 创建人：
 377          * 修改日期
 378          * 修改人：
 379          * 第N次修改：
 380          * 修改原因：
 381          * 备注：
 382          *******************************************************************************/
 383          void Display_SetRTC(void)
 384          {
 385   1              if((Flag_0_5s)||(NoFlash()))
 386   1              {
 387   2                      Display_HH_MM(eDS_RTC);
 388   2              }
 389   1      }
 390          
 391          
 392          /*******************************************************************************
 393          * 函数原型：
 394          * 输入参数：
 395          * 输出参数：
 396          * 函数功能：设置RTC时LED的年份显示
 397          * 返回值说明：
 398          * 创建日期：
 399          * 创建人：
 400          * 修改日期
 401          * 修改人：
 402          * 第N次修改：
 403          * 修改原因：
 404          * 备注：
 405          *******************************************************************************/
 406          void Display_SetRTCYear(void)
 407          {
 408   1              if((Flag_0_5s)||(NoFlash()))
 409   1              {
 410   2                      //0.5进来一次，20和18交替显示
 411   2                      if(Flag_Year_0_5s_Disp==0)
 412   2                      {
 413   3                              //DisplayNum12(20);
 414   3                              SET_2G();//显示一个"-"
 415   3                              DisplayNum34(20);
 416   3                      }
 417   2                      else
 418   2                      {
 419   3                              SET_2G();//显示一个"-"
 420   3                              DisplayNum34(gRTC_Year);
 421   3                      }
 422   2                      
 423   2              }
 424   1      }
 425          
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 8   

 426          /*******************************************************************************
 427          * 函数原型：
 428          * 输入参数：
 429          * 输出参数：
 430          * 函数功能：设置RTC时LED的月的LED显示
 431          * 返回值说明：
 432          * 创建日期：
 433          * 创建人：
 434          * 修改日期
 435          * 修改人：
 436          * 第N次修改：
 437          * 修改原因：
 438          * 备注：
 439          *******************************************************************************/
 440          void Display_SetRTCMonth(void)
 441          {
 442   1              if((Flag_0_5s)||(NoFlash()))
 443   1              {
 444   2                      DisplayNum12(gRTC_Month);
 445   2              }
 446   1              DisplayNum34(gRTC_Day);
 447   1      }
 448          
 449          /*******************************************************************************
 450          * 函数原型：
 451          * 输入参数：
 452          * 输出参数：
 453          * 函数功能：设置RTC时LED的日的LED显示
 454          * 返回值说明：
 455          * 创建日期：
 456          * 创建人：
 457          * 修改日期
 458          * 修改人：
 459          * 第N次修改：
 460          * 修改原因：
 461          * 备注：
 462          *******************************************************************************/
 463          //这里暂时不用
 464          void Display_SetRTCDay(void)
 465          {
 466   1              if((Flag_0_5s)||(NoFlash()))
 467   1              {
 468   2                      DisplayNum34(gRTC_Day);
 469   2              }
 470   1              DisplayNum12(gRTC_Month);
 471   1      }
 472          
 473          
 474          /*******************************************************************************
 475          * 函数原型：
 476          * 输入参数：
 477          * 输出参数：
 478          * 函数功能：设置RTC时LED的小时的LED显示
 479          * 返回值说明：
 480          * 创建日期：
 481          * 创建人：
 482          * 修改日期
 483          * 修改人：
 484          * 第N次修改：
 485          * 修改原因：
 486          * 备注：
 487          *******************************************************************************/
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 9   

 488          void Display_SetRTCHour(void)
 489          {
 490   1              if((Flag_0_5s)||(NoFlash()))
 491   1              {
 492   2                      //DisplayNum12(gRTC_Hour);
 493   2                      Display_HH_MM(ADJ_CLK);
 494   2              }
 495   1              //DisplayNum34(gRTC_Minute);
 496   1              Display_MM(ADJ_CLK);
 497   1      }
 498          
 499          /*******************************************************************************
 500          * 函数原型：
 501          * 输入参数：
 502          * 输出参数：
 503          * 函数功能：设置RTC时LED的分钟的LED显示
 504          * 返回值说明：
 505          * 创建日期：
 506          * 创建人：
 507          * 修改日期
 508          * 修改人：
 509          * 第N次修改：
 510          * 修改原因：
 511          * 备注：
 512          *******************************************************************************/
 513          void Display_SetRTCMinute(void)
 514          {
 515   1              if((Flag_0_5s)||(NoFlash()))
 516   1              {
 517   2                      //DisplayNum34(gRTC_Minute);
 518   2                      Display_HH_MM(ADJ_CLK);
 519   2              }
 520   1              Display_HH(ADJ_CLK);//显示小时
 521   1      }
 522          
 523          /*******************************************************************************
 524          * 函数原型：
 525          * 输入参数：
 526          * 输出参数：
 527          * 函数功能：夏令时区选择
 528          * 返回值说明：
 529          * 创建日期：
 530          * 创建人：
 531          * 修改日期
 532          * 修改人：
 533          * 第N次修改：
 534          * 修改原因：
 535          * 备注：
 536          *******************************************************************************/
 537          void Display_SetZone(void)
 538          {
 539   1              if((Flag_0_5s)||(NoFlash()))
 540   1              {
 541   2                      DisplayNum34(gRTC_Zone);
 542   2              }
 543   1      }
 544          
 545          /*******************************************************************************
 546          * 函数原型：
 547          * 输入参数：
 548          * 输出参数：
 549          * 函数功能：贪睡时间
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 10  

 550          * 返回值说明：
 551          * 创建日期：
 552          * 创建人：
 553          * 修改日期
 554          * 修改人：
 555          * 第N次修改：
 556          * 修改原因：
 557          * 备注：
 558          *******************************************************************************/
 559          void Display_SnoozeTime(void)
 560          {
 561   1              if((Flag_0_5s)||(NoFlash()))
 562   1              {
 563   2                      Display_MM(ADJ_SNOOZE_TIME);
 564   2              }
 565   1      }
 566          
 567          /*******************************************************************************
 568          * 函数原型：
 569          * 输入参数：
 570          * 输出参数：
 571          * 函数功能：闹钟非设置时的显示
 572          * 返回值说明：
 573          * 创建日期：
 574          * 创建人：
 575          * 修改日期
 576          * 修改人：
 577          * 第N次修改：
 578          * 修改原因：
 579          * 备注：
 580          *******************************************************************************/
 581          void Display_Alarm1(void)
 582          {
 583   1              
 584   1      }
 585          
 586          /*******************************************************************************
 587          * 函数原型：
 588          * 输入参数：
 589          * 输出参数：
 590          * 函数功能：闹钟设置时的显示
 591          * 返回值说明：
 592          * 创建日期：
 593          * 创建人：
 594          * 修改日期
 595          * 修改人：
 596          * 第N次修改：
 597          * 修改原因：
 598          * 备注：
 599          *******************************************************************************/
 600          void Display_SetAlarm1(void)
 601          {
 602   1              
 603   1      }
 604          
 605          /*******************************************************************************
 606          * 函数原型：
 607          * 输入参数：
 608          * 输出参数：
 609          * 函数功能：设置闹钟小时的显示
 610          * 返回值说明：
 611          * 创建日期：
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 11  

 612          * 创建人：
 613          * 修改日期
 614          * 修改人：
 615          * 第N次修改：
 616          * 修改原因：
 617          * 备注：
 618          *******************************************************************************/
 619          void Display_SetAlarm1_Hour(void)
 620          {
 621   1              if((Flag_0_5s)||(NoFlash()))
 622   1              {
 623   2                      Display_HH_MM(ADJ_ALARM1);
 624   2              }
 625   1              Display_MM(ADJ_ALARM1);//显示分钟
 626   1      }
 627          
 628          /*******************************************************************************
 629          * 函数原型：
 630          * 输入参数：
 631          * 输出参数：
 632          * 函数功能：设置闹钟分钟的显示
 633          * 返回值说明：
 634          * 创建日期：
 635          * 创建人：
 636          * 修改日期
 637          * 修改人：
 638          * 第N次修改：
 639          * 修改原因：
 640          * 备注：
 641          *******************************************************************************/
 642          void Display_SetAlarm1_Min(void)
 643          {
 644   1              if((Flag_0_5s)||(NoFlash()))
 645   1              {
 646   2                      Display_HH_MM(ADJ_ALARM1);
 647   2              }
 648   1              Display_HH(ADJ_ALARM1);//显示分钟
 649   1      }
 650          
 651          /*******************************************************************************
 652          * 函数原型：
 653          * 输入参数：
 654          * 输出参数：
 655          * 函数功能：设置闹钟工作模式的显示
 656          * 返回值说明：
 657          * 创建日期：
 658          * 创建人：
 659          * 修改日期
 660          * 修改人：
 661          * 第N次修改：
 662          * 修改原因：
 663          * 备注：
 664          *******************************************************************************/
 665          void Display_SetAlarm1_Work(void)
 666          {
 667   1              
 668   1      }
 669          
 670          /*******************************************************************************
 671          * 函数原型：
 672          * 输入参数：
 673          * 输出参数：
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 12  

 674          * 函数功能：在某个状态时显示10秒，比如设置RTC或者闹钟时闪烁或者显示长度
 675          * 返回值说明：
 676          * 创建日期：
 677          * 创建人：
 678          * 修改日期
 679          * 修改人：
 680          * 第N次修改：
 681          * 修改原因：
 682          * 备注：
 683          *******************************************************************************/
 684          void SetDisplayState10s(uint8_t status)
 685          {
 686   1              Flag_DisplayStatus=status;//把要显示的状态赋值给全局变量
 687   1              cntDisplayStatus=cDISP_DELAY_10SEC;
 688   1      }
 689          
 690          /*******************************************************************************
 691          * 函数原型：
 692          * 输入参数：
 693          * 输出参数：
 694          * 函数功能：在某个状态时显示2秒，比如设置RTC或者闹钟时闪烁或者显示长度
 695          * 返回值说明：
 696          * 创建日期：
 697          * 创建人：
 698          * 修改日期
 699          * 修改人：
 700          * 第N次修改：
 701          * 修改原因：
 702          * 备注：
 703          *******************************************************************************/
 704          void SetDisplayState2s(uint8_t status)
 705          {
 706   1              Flag_DisplayStatus=status;//把要显示的状态赋值给全局变量
 707   1              cntDisplayStatus=cDISP_DELAY_5SEC;
 708   1      }
 709          
 710          /*******************************************************************************
 711          * 函数原型：
 712          * 输入参数：
 713          * 输出参数：
 714          * 函数功能：更新要显示的内容
 715          * 返回值说明：
 716          * 创建日期：
 717          * 创建人：
 718          * 修改日期
 719          * 修改人：
 720          * 第N次修改：
 721          * 修改原因：
 722          * 备注：
 723          *******************************************************************************/
 724          void UpdateDisplay(void)
 725          {
 726   1              switch (Flag_DisplayStatus)
 727   1              {
 728   2                      case ADJ_CLK:
 729   2                              Display_SetRTC();                //设置RTC时的显示
 730   2                              break;
 731   2                      case ADJ_YEAR:                           //设置RTC的年
 732   2                              Display_SetRTCYear();
 733   2                              break;
 734   2                      case ADJ_MONTH:                          //设置RTC的日期
 735   2                              Display_SetRTCMonth();
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 13  

 736   2                              break;
 737   2                      case ADJ_DAY:                            //设置RTC的日期
 738   2                              Display_SetRTCDay();
 739   2                              break;
 740   2                      case ADJ_HOUR:                           //设置RTC小时的显示
 741   2                              Display_SetRTCHour();
 742   2                              break;
 743   2                      case ADJ_MINUTE:                         //设置RTC分钟的显示
 744   2                              Display_SetRTCMinute();
 745   2                              break;
 746   2                      case ADJ_DAYLIGHT_SAVING_ZONES://设置夏令时区
 747   2                              Display_SetZone();
 748   2                              break; 
 749   2                      case ADJ_SNOOZE_TIME:            //设置贪睡时间
 750   2                              Display_SnoozeTime();
 751   2                              break; 
 752   2                      case DISP_AL1:                           //闹钟非设置时的显示
 753   2                              Display_Alarm1();   
 754   2                              break;
 755   2                      case ADJ_ALARM1:                         //设置闹钟的显示
 756   2                              Display_SetAlarm1();     
 757   2                              break;
 758   2                      case ADJ_ALARM1_HOUR:            //设置闹钟小时的显示
 759   2                              Display_SetAlarm1_Hour();
 760   2                              break; 
 761   2                      case ADJ_ALARM1_MINUTE:          //设置闹钟分钟的显示
 762   2                              Display_SetAlarm1_Min(); 
 763   2                              break; 
 764   2                      case POWER_OFF_DISP:             //关闭显示
 765   2                              Display_Off();
 766   2                              break; 
 767   2                      default:
 768   2                              Display_RTC();                   //RTC走时状态显示
 769   2                              break;
 770   2              }
 771   1              if (cntNoFlash != 0)
 772   1                      cntNoFlash--;
 773   1      }
 774          
 775          /*******************************************************************************
 776          * 函数原型：
 777          * 输入参数：
 778          * 输出参数：
 779          * 函数功能：需要亮的一些标记，比如点，或者闹钟标志
 780          * 返回值说明：
 781          * 创建日期：
 782          * 创建人：
 783          * 修改日期
 784          * 修改人：
 785          * 第N次修改：
 786          * 修改原因：
 787          * 备注：
 788          *******************************************************************************/
 789          void Display_Flag(void)
 790          {
 791   1              if(Flag_PowerOn)//开机进入
 792   1              {
 793   2                      if(Flag_APM==0)
 794   2                      {
 795   3                              CLR_APM();//这里是上午不亮，下午亮
 796   3                      }
 797   2                      else
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 14  

 798   2                      {
 799   3                              SET_APM();
 800   3                      }
 801   2                      
 802   2                      if(AL1_TD.OnOff_TD==ALARM_ON)
 803   2                      {
 804   3                              SET_ALA();//如果开蓝牙就亮闹钟标志
 805   3                      }
 806   2                      else if(AL1_TD.OnOff_TD==ALARM_OFF)
 807   2                      {
 808   3                              CLR_ALA();
 809   3                      }
 810   2                      
 811   2                      if(Flag_Dot==1)
 812   2                      {
 813   3                              SET_DOT1();//在main中的INT_WT()设立标志，
 814   3                              SET_DOT2();
 815   3                      }
 816   2                      else
 817   2                      {
 818   3                              CLR_DOT1();
 819   3                              CLR_DOT2();
 820   3                      }
 821   2              }
 822   1      }
 823          
 824          /*******************************************************************************
 825          * 函数原型：
 826          * 输入参数：
 827          * 输出参数：
 828          * 函数功能：更新要显示的内容
 829          * 返回值说明：
 830          * 创建日期：
 831          * 创建人：
 832          * 修改日期
 833          * 修改人：
 834          * 第N次修改：
 835          * 修改原因：
 836          * 备注：
 837          *******************************************************************************/
 838          void Display(void)
 839          {
 840   1              //uint8_t i;
 841   1              //if(cntDisplayStatus)
 842   1              //{
 843   1                      ClearDisplayBuff();
 844   1                      UpdateDisplay();
 845   1                      Display_Flag();
 846   1                      Display_LED();
 847   1                      cli();
 848   1                      LED_Tmp1 = LED_Reg1;
 849   1                      LED_Tmp2 = LED_Reg2;
 850   1                      LED_Tmp3 = LED_Reg3;
 851   1                      LED_Tmp4 = LED_Reg4;
 852   1                      sei();
 853   1              //}
 854   1      }
 855          
 856          
 857          
 858          
 859          
C51 COMPILER V9.00   LED_MODE                                                              12/06/2018 14:18:27 PAGE 15  

 860          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    716    ----
   CONSTANT SIZE    =     38    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       6
   IDATA SIZE       =      7    ----
   BIT SIZE         =      7    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
